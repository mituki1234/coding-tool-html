<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç≥„Éº„Éâ„Ç®„Éá„Ç£„Çø„Éº with „Éó„É¨„Éì„É•„Éº</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .main-content {
            display: flex;
            gap: 20px;
        }

        .file-sidebar {
            width: 250px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            display: flex;
            flex-direction: column;
            max-height: 700px;
        }

        .directory-tree {
            flex: 1;
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 10px;
        }

        .tree-item {
            margin: 4px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .tree-item.directory {
            font-weight: bold;
        }

        .tree-item.file {
            margin-left: 15px;
        }

        .tree-item:hover {
            background-color: #f5f5f5;
        }

        .tree-item.active {
            background-color: #e0e7ff;
            border-radius: 3px;
        }

        .tree-toggle {
            cursor: pointer;
            margin-right: 5px;
        }

        .tree-children {
            margin-left: 15px;
            display: none;
        }

        .tree-children.expanded {
            display: block;
        }

        .editor-container {
            flex: 1;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .file-tabs {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            max-width: 70%;
        }

        .file-tab {
            padding: 8px 15px;
            background-color: #f0f0f0;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            border: 1px solid #ddd;
            border-bottom: none;
            position: relative;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-tab.active {
            background-color: #fff;
            border-bottom: 2px solid #4285f4;
        }

        .file-tab .close-tab {
            position: absolute;
            right: 5px;
            top: 5px;
            font-size: 12px;
            opacity: 0.7;
            cursor: pointer;
        }

        .file-tab .close-tab:hover {
            opacity: 1;
        }

        .editor-buttons {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 8px 15px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #3367d6;
        }

        button.secondary {
            background-color: #f1f1f1;
            color: #333;
        }

        button.secondary:hover {
            background-color: #e0e0e0;
        }

        textarea {
            width: 100%;
            height: 400px;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
            tab-size: 4;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .preview-popup {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            height: 90%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .popup-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .device-selector {
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background-color: white;
        }

        .close-popup {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #333;
        }

        .preview-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-color: #f9f9f9;
            overflow: auto;
        }

        #preview-frame {
            border: none;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            background-color: white;
        }

        .file-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .file-input input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .file-input button {
            white-space: nowrap;
        }

        .hidden {
            display: none;
        }

        .file-manager {
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
        }

        .file-list {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-actions {
            display: flex;
            gap: 5px;
        }

        .file-actions button {
            padding: 2px 5px;
            font-size: 12px;
        }

        /* „Ç¢„Ç§„Ç≥„É≥Ë°®Á§∫Áî® */
        .file-icon {
            margin-right: 5px;
            width: 16px;
            height: 16px;
            display: inline-block;
        }

        .file-icon.html:before {
            content: "üåê";
        }

        .file-icon.css:before {
            content: "üé®";
        }

        .file-icon.js:before {
            content: "üìú";
        }

        .file-icon.folder:before {
            content: "üìÅ";
        }

        .file-icon.file:before {
            content: "üìÑ";
        }

        .bottom-bar {
            margin-top: 10px;
            padding: 10px;
            background-color: #f1f1f1;
            border-radius: 5px;
            font-size: 12px;
            color: #555;
        }

        .import-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>„Ç≥„Éº„Éâ„Ç®„Éá„Ç£„Çø„Éº with „Éó„É¨„Éì„É•„Éº</h1>
        
        <div class="main-content">
            <div class="file-sidebar">
                <div class="import-controls">
                    <button id="import-dir-btn">„Éá„Ç£„É¨„ÇØ„Éà„É™„Çí„Ç§„É≥„Éù„Éº„Éà</button>
                    <input type="file" id="dir-input" webkitdirectory directory multiple class="hidden">
                </div>
                
                <div class="directory-tree" id="directory-tree">
                    <div class="tree-item directory">
                        <span class="tree-toggle">‚ñ∂</span>
                        <span class="file-icon folder"></span>
                        <span>„Éó„É≠„Ç∏„Çß„ÇØ„Éà</span>
                    </div>
                    <div class="tree-children">
                        <div class="tree-item file active" data-file="index.html">
                            <span class="file-icon html"></span>
                            <span>index.html</span>
                        </div>
                        <div class="tree-item file" data-file="style.css">
                            <span class="file-icon css"></span>
                            <span>style.css</span>
                        </div>
                        <div class="tree-item file" data-file="script.js">
                            <span class="file-icon js"></span>
                            <span>script.js</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="editor-container">
                <div class="editor-header">
                    <div class="file-tabs" id="file-tabs">
                        <div class="file-tab active" data-file="index.html">HTML</div>
                        <div class="file-tab" data-file="style.css">CSS</div>
                        <div class="file-tab" data-file="script.js">JavaScript</div>
                    </div>
                    
                    <div class="editor-buttons">
                        <button id="add-file-btn">„Éï„Ç°„Ç§„É´ËøΩÂä†</button>
                        <button id="preview-btn">„Éó„É¨„Éì„É•„ÉºË°®Á§∫</button>
                    </div>
                </div>
                
                <div class="file-input hidden">
                    <input type="text" id="file-path" placeholder="„Éï„Ç°„Ç§„É´„Éë„Çπ (‰æã: styles/main.css)">
                    <select id="file-type">
                        <option value="css">CSS</option>
                        <option value="js">JavaScript</option>
                        <option value="html">HTML</option>
                    </select>
                    <button id="save-file-btn">‰øùÂ≠ò</button>
                    <button id="cancel-file-btn" class="secondary">„Ç≠„É£„É≥„Çª„É´</button>
                </div>
                
                <textarea id="html-editor" placeholder="HTML„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                <textarea id="css-editor" class="hidden" placeholder="CSS„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                <textarea id="js-editor" class="hidden" placeholder="JavaScript„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                <textarea id="custom-editor" class="hidden" placeholder="„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                
                <div class="bottom-bar">
                    <span id="current-file">ÁèæÂú®Á∑®ÈõÜ‰∏≠: index.html</span>
                </div>
            </div>
        </div>
    </div>

    <div class="popup-overlay" id="popup-overlay">
        <div class="preview-popup">
            <div class="popup-header">
                <div class="preview-controls">
                    <h2>„Éó„É¨„Éì„É•„Éº</h2>
                    <select id="device-selector" class="device-selector">
                        <option value="desktop">„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó (100%)</option>
                        <option value="tablet">„Çø„Éñ„É¨„ÉÉ„Éà (768px)</option>
                        <option value="mobile">„É¢„Éê„Ç§„É´ (375px)</option>
                    </select>
                </div>
                <button class="close-popup" id="close-popup">&times;</button>
            </div>
            <div class="preview-container" id="preview-container">
                <iframe id="preview-frame"></iframe>
            </div>
        </div>
    </div>

    <script>
        // „Éï„Ç°„Ç§„É´ÁÆ°ÁêÜ
        const files = {
            'index.html': '',
            'style.css': '',
            'script.js': ''
        };
        
        const customFiles = {};
        let currentEditingFile = 'index.html';
        let activeEditor = 'html-editor';
        
        // DOMË¶ÅÁ¥†
        const htmlEditor = document.getElementById('html-editor');
        const cssEditor = document.getElementById('css-editor');
        const jsEditor = document.getElementById('js-editor');
        const customEditor = document.getElementById('custom-editor');
        const fileTabs = document.querySelectorAll('.file-tab');
        const fileTabsContainer = document.getElementById('file-tabs');
        const previewBtn = document.getElementById('preview-btn');
        const popupOverlay = document.getElementById('popup-overlay');
        const closePopupBtn = document.getElementById('close-popup');
        const previewFrame = document.getElementById('preview-frame');
        const addFileBtn = document.getElementById('add-file-btn');
        const fileInput = document.querySelector('.file-input');
        const filePathInput = document.getElementById('file-path');
        const fileTypeSelect = document.getElementById('file-type');
        const saveFileBtn = document.getElementById('save-file-btn');
        const cancelFileBtn = document.getElementById('cancel-file-btn');
        const directoryTree = document.getElementById('directory-tree');
        const deviceSelector = document.getElementById('device-selector');
        const previewContainer = document.getElementById('preview-container');
        const currentFileDisplay = document.getElementById('current-file');
        const importDirBtn = document.getElementById('import-dir-btn');
        const dirInput = document.getElementById('dir-input');
        
        // ÂàùÊúüË®≠ÂÆö
        htmlEditor.value = '<!DOCTYPE html>\n<html>\n<head>\n  <title>„Éû„Ç§„Éö„Éº„Ç∏</title>\n  <link rel="stylesheet" href="style.css">\n  <script src="script.js"><\/script>\n</head>\n<body>\n  <h1>„Åì„Çì„Å´„Å°„ÅØ„ÄÅ‰∏ñÁïåÔºÅ</h1>\n  <p>„Åì„Åì„Å´„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅåÂÖ•„Çä„Åæ„Åô„ÄÇ</p>\n</body>\n</html>';
        cssEditor.value = 'body {\n  font-family: Arial, sans-serif;\n  margin: 20px;\n  background-color: #f0f0f0;\n}\n\nh1 {\n  color: #333;\n  text-align: center;\n}';
        jsEditor.value = 'document.addEventListener("DOMContentLoaded", function() {\n  console.log("„Éö„Éº„Ç∏„ÅåË™≠„ÅøËæº„Åæ„Çå„Åæ„Åó„ÅüÔºÅ");\n});';
        
        files['index.html'] = htmlEditor.value;
        files['style.css'] = cssEditor.value;
        files['script.js'] = jsEditor.value;
        
        // „Éá„Ç£„É¨„ÇØ„Éà„É™„ÉÑ„É™„Éº„ÅÆ„Éà„Ç∞„É´
        document.querySelectorAll('.tree-toggle').forEach(toggle => {
            toggle.addEventListener('click', (e) => {
                const parent = e.target.parentElement;
                const children = parent.nextElementSibling;
                
                if (children && children.classList.contains('tree-children')) {
                    children.classList.toggle('expanded');
                    e.target.textContent = children.classList.contains('expanded') ? '‚ñº' : '‚ñ∂';
                }
            });
        });
        
        // ÂàùÊúüË°®Á§∫„ÅÆ„Åü„ÇÅ„Å´„Éà„ÉÉ„Éó„É¨„Éô„É´„ÅÆ„ÉÑ„É™„Éº„ÇíÂ±ïÈñã
        document.querySelector('.tree-toggle').click();
        
        // „Éï„Ç°„Ç§„É´„ÉÑ„É™„Éº„Åã„Çâ„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû
        document.querySelectorAll('.tree-item.file').forEach(item => {
            item.addEventListener('click', () => {
                const filePath = item.getAttribute('data-file');
                openFile(filePath);
                
                // „ÉÑ„É™„Éº„Ç¢„Ç§„ÉÜ„É†„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                document.querySelectorAll('.tree-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
            });
        });
        
        // „Éï„Ç°„Ç§„É´„Çø„Éñ„ÅÆÂàá„ÇäÊõø„Åà
        fileTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const filePath = tab.getAttribute('data-file');
                openFile(filePath);
            });
        });
        
        // „Éï„Ç°„Ç§„É´„ÇíÈñã„ÅèÈñ¢Êï∞
        function openFile(filePath) {
            // ÁèæÂú®„ÅÆ„Éï„Ç°„Ç§„É´„ÅÆÂÜÖÂÆπ„Çí‰øùÂ≠ò
            saveCurrentFile();
            
            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Éñ„ÇíÂàá„ÇäÊõø„Åà
            document.querySelectorAll('.file-tab').forEach(t => t.classList.remove('active'));
            let tabToActivate = document.querySelector(`.file-tab[data-file="${filePath}"]`);
            
            if (!tabToActivate) {
                // „Çø„Éñ„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅØÊñ∞„Åó„Åè‰ΩúÊàê
                addFileTab(filePath);
                tabToActivate = document.querySelector(`.file-tab[data-file="${filePath}"]`);
            }
            
            if (tabToActivate) {
                tabToActivate.classList.add('active');
            }
            
            // „Ç®„Éá„Ç£„Çø„Éº„ÇíÂàá„ÇäÊõø„Åà
            htmlEditor.classList.add('hidden');
            cssEditor.classList.add('hidden');
            jsEditor.classList.add('hidden');
            customEditor.classList.add('hidden');
            
            // „Éï„Ç°„Ç§„É´„ÅÆÊã°ÂºµÂ≠ê„ÅßÂà§Êñ≠
            const fileExt = filePath.split('.').pop().toLowerCase();
            let editorToShow;
            
            if (filePath === 'index.html') {
                editorToShow = htmlEditor;
                activeEditor = 'html-editor';
            } else if (filePath === 'style.css') {
                editorToShow = cssEditor;
                activeEditor = 'css-editor';
            } else if (filePath === 'script.js') {
                editorToShow = jsEditor;
                activeEditor = 'js-editor';
            } else {
                editorToShow = customEditor;
                activeEditor = 'custom-editor';
                
                // „Ç´„Çπ„Çø„É†„Éï„Ç°„Ç§„É´„ÅÆÂÜÖÂÆπ„Çí„É≠„Éº„Éâ
                customEditor.value = customFiles[filePath] || '';
            }
            
            editorToShow.classList.remove('hidden');
            currentEditingFile = filePath;
            
            // ÁèæÂú®Á∑®ÈõÜ‰∏≠„ÅÆ„Éï„Ç°„Ç§„É´Ë°®Á§∫„ÇíÊõ¥Êñ∞
            currentFileDisplay.textContent = `ÁèæÂú®Á∑®ÈõÜ‰∏≠: ${filePath}`;
        }
        
        // ÁèæÂú®„ÅÆ„Éï„Ç°„Ç§„É´„Çí‰øùÂ≠ò
        function saveCurrentFile() {
            if (currentEditingFile === 'index.html') {
                files['index.html'] = htmlEditor.value;
            } else if (currentEditingFile === 'style.css') {
                files['style.css'] = cssEditor.value;
            } else if (currentEditingFile === 'script.js') {
                files['script.js'] = jsEditor.value;
            } else if (customFiles[currentEditingFile] !== undefined) {
                customFiles[currentEditingFile] = customEditor.value;
            }
        }
        
        // „Éï„Ç°„Ç§„É´„Çø„Éñ„ÇíËøΩÂä†
        function addFileTab(filePath) {
            const fileTab = document.createElement('div');
            fileTab.className = 'file-tab';
            fileTab.setAttribute('data-file', filePath);
            
            // „Éï„Ç°„Ç§„É´Âêç„ÇíÂèñÂæóÔºà„Éë„Çπ„ÅÆÊúÄÂæå„ÅÆÈÉ®ÂàÜÔºâ
            const fileName = filePath.split('/').pop();
            
            fileTab.innerHTML = `
                ${fileName}
                <span class="close-tab" data-file="${filePath}">&times;</span>
            `;
            
            fileTabsContainer.appendChild(fileTab);
            
            // „Çø„Éñ„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
            fileTab.addEventListener('click', () => {
                openFile(filePath);
            });
            
            // Èñâ„Åò„Çã„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà
            fileTab.querySelector('.close-tab').addEventListener('click', (e) => {
                e.stopPropagation();
                closeFileTab(filePath);
            });
        }
        
        // „Éï„Ç°„Ç§„É´„Çø„Éñ„ÇíÈñâ„Åò„Çã
        function closeFileTab(filePath) {
            const tab = document.querySelector(`.file-tab[data-file="${filePath}"]`);
            
            // „Éá„Éï„Ç©„É´„Éà„ÅÆ„Çø„Éñ„ÅØÈñâ„Åò„Çâ„Çå„Å™„ÅÑ
            if (filePath === 'index.html' || filePath === 'style.css' || filePath === 'script.js') {
                return;
            }
            
            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Éñ„ÇíÈñâ„Åò„ÇãÂ†¥Âêà„ÅØ„ÄÅÂà•„ÅÆ„Çø„Éñ„Å´Âàá„ÇäÊõø„Åà„Çã
            if (tab.classList.contains('active')) {
                // „Éá„Éï„Ç©„É´„Éà„ÅÆindex.html„Çø„Éñ„ÇíÈÅ∏Êäû
                openFile('index.html');
            }
            
            // „Çø„Éñ„ÇíÂâäÈô§
            tab.remove();
        }
        
        // „Éï„Ç°„Ç§„É´„ÅÆËá™Âãï‰øùÂ≠ò
        [htmlEditor, cssEditor, jsEditor, customEditor].forEach(editor => {
            editor.addEventListener('input', () => {
                saveCurrentFile();
            });
        });
        
        // „Éï„Ç°„Ç§„É´ËøΩÂä†UIË°®Á§∫
        addFileBtn.addEventListener('click', () => {
            fileInput.classList.toggle('hidden');
        });
        
        // „Éï„Ç°„Ç§„É´ËøΩÂä†„Ç≠„É£„É≥„Çª„É´
        cancelFileBtn.addEventListener('click', () => {
            fileInput.classList.add('hidden');
            filePathInput.value = '';
        });
        
        // Êñ∞„Åó„ÅÑ„Éï„Ç°„Ç§„É´„ÇíËøΩÂä†
        saveFileBtn.addEventListener('click', () => {
            const filePath = filePathInput.value.trim();
            const fileType = fileTypeSelect.value;
            
            if (filePath) {
                // Êã°ÂºµÂ≠ê„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                let extension = filePath.split('.').pop().toLowerCase();
                if (fileType === 'css' && extension !== 'css') {
                    alert('CSS„Éï„Ç°„Ç§„É´„ÅÆÊã°ÂºµÂ≠ê„ÅØ.css„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô');
                    return;
                } else if (fileType === 'js' && extension !== 'js') {
                    alert('JavaScript„Éï„Ç°„Ç§„É´„ÅÆÊã°ÂºµÂ≠ê„ÅØ.js„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô');
                    return;
                } else if (fileType === 'html' && extension !== 'html') {
                    alert('HTML„Éï„Ç°„Ç§„É´„ÅÆÊã°ÂºµÂ≠ê„ÅØ.html„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô');
                    return;
                }
                
                // Êó¢Â≠ò„Éï„Ç°„Ç§„É´„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                if (files[filePath] || customFiles[filePath]) {
                    alert('„Åì„ÅÆ„Éï„Ç°„Ç§„É´„ÅØÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô');
                    return;
                }
                
                // Êñ∞„Åó„ÅÑ„Éï„Ç°„Ç§„É´„ÇíËøΩÂä†
                customFiles[filePath] = '';
                updateDirectoryTree();
                
                // Êñ∞„Åó„ÅÑ„Éï„Ç°„Ç§„É´„ÇíÈñã„Åè
                openFile(filePath);
                
                fileInput.classList.add('hidden');
                filePathInput.value = '';
            } else {
                alert('ÊúâÂäπ„Å™„Éï„Ç°„Ç§„É´„Éë„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
        });
        
        // „Éá„Ç£„É¨„ÇØ„Éà„É™„Ç§„É≥„Éù„Éº„Éà
        importDirBtn.addEventListener('click', () => {
            dirInput.click();
        });
        
        dirInput.addEventListener('change', async (e) => {
            const files = e.target.files;
            
            if (files.length > 0) {
                // „Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„ÅøÁî®„ÅÆÈñ¢Êï∞
                const readFile = (file) => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (e) => resolve(e.target.result);
                        reader.onerror = reject;
                        reader.readAsText(file);
                    });
                };
                
                // „Éá„Ç£„É¨„ÇØ„Éà„É™ÊßãÈÄ†„ÇíÊßãÁØâ
                const directoryStructure = {};
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const path = file.webkitRelativePath;
                    
                    // „Éï„Ç°„Ç§„É´„ÅÆÁ®ÆÈ°û„ÇíÂà§Êñ≠„Åó„ÄÅ„ÉÜ„Ç≠„Çπ„Éà„Éï„Ç°„Ç§„É´„ÅÆ„Åø„Ç§„É≥„Éù„Éº„Éà
                    const fileExt = path.split('.').pop().toLowerCase();
                    if (['html', 'css', 'js', 'txt', 'md', 'json', 'xml', 'svg'].includes(fileExt)) {
                        try {
                            const content = await readFile(file);
                            customFiles[path] = content;
                        } catch (error) {
                            console.error('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:', error);
                        }
                    }
                }
                
                // „Éá„Ç£„É¨„ÇØ„Éà„É™„ÉÑ„É™„Éº„ÇíÊõ¥Êñ∞
                updateDirectoryTree();
            }
        });
        
        // „Éá„Ç£„É¨„ÇØ„Éà„É™„ÉÑ„É™„Éº„ÇíÊõ¥Êñ∞
        function updateDirectoryTree() {
            // „Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆ„É´„Éº„Éà„Éá„Ç£„É¨„ÇØ„Éà„É™
            const rootDir = directoryTree.querySelector('.tree-item.directory');
            const rootChildren = directoryTree.querySelector('.tree-children');
            rootChildren.innerHTML = '';
            
            // „Éá„Éï„Ç©„É´„Éà„ÅÆ„Éï„Ç°„Ç§„É´„ÇíËøΩÂä†
            const defaultFiles = [
                { path: 'index.html', icon: 'html' },
                { path: 'style.css', icon: 'css' },
                { path: 'script.js', icon: 'js' }
            ];
            
            // „Éá„Éï„Ç©„É´„Éà„Éï„Ç°„Ç§„É´„Çí„ÉÑ„É™„Éº„Å´ËøΩÂä†
            defaultFiles.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'tree-item file';
                fileItem.setAttribute('data-file', file.path);
                fileItem.innerHTML = `
                    <span class="file-icon ${file.icon}"></span>
                    <span>${file.path}</span>
                `;
                rootChildren.appendChild(fileItem);
                
                // „Éï„Ç°„Ç§„É´„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
                fileItem.addEventListener('click', () => {
                    openFile(file.path);
                    
                    // „ÉÑ„É™„Éº„Ç¢„Ç§„ÉÜ„É†„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                    document.querySelectorAll('.tree-item').forEach(i => i.classList.remove('active'));
                    fileItem.classList.add('active');
                });
            });
            
            // „Ç´„Çπ„Çø„É†„Éï„Ç°„Ç§„É´„ÅÆËøΩÂä†
            const dirMap = {}; // „Éá„Ç£„É¨„ÇØ„Éà„É™ÊßãÈÄ†„Çí„Éû„ÉÉ„Éî„É≥„Ç∞
            
            // ÂÖ®„Å¶„ÅÆ„Ç´„Çπ„Çø„É†„Éï„Ç°„Ç§„É´„Çí„ÉÑ„É™„ÉºÊßãÈÄ†„Å´Â§âÊèõ
            Object.keys(customFiles).sort().forEach(filePath => {
                const segments = filePath.split('/');
                const fileName = segments.pop();
                let currentPath = '';
                let currentMap = dirMap;
                
                // „Éá„Ç£„É¨„ÇØ„Éà„É™„Éë„Çπ„ÇíÊßãÁØâ
                segments.forEach(segment => {
                    currentPath = currentPath ? `${currentPath}/${segment}` : segment;
                    if (!currentMap[segment]) {
                        currentMap[segment] = { _files: [], _path: currentPath };
                    }
                    currentMap = currentMap[segment];
                });
                
                // „Éï„Ç°„Ç§„É´„Çí„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´ËøΩÂä†
                currentMap._files.push({
                    name: fileName,
                    path: filePath
                });
            });
            
            // „Éá„Ç£„É¨„ÇØ„Éà„É™„ÉÑ„É™„Éº„ÇíÂÜçÂ∏∞ÁöÑ„Å´ÊßãÁØâ
            function buildTreeFromMap(map, parentElement) {
                // „Éá„Ç£„É¨„ÇØ„Éà„É™„Çí‰ΩúÊàê
                Object.keys(map).forEach(dirName => {
                    if (dirName === '_files' || dirName === '_path') return;
                    
                    const dirItem = document.createElement('div');
                    dirItem.className = 'tree-item directory';
                    dirItem.innerHTML = `
                        <span class="tree-toggle">‚ñ∂</span>
                        <span class="file-icon folder"></span>
                        <span>${dirName}</span>
                    `;
                    parentElement.appendChild(dirItem);
                    
                    // „Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆÂ≠êË¶ÅÁ¥†„Ç≥„É≥„ÉÜ„Éä
                    const dirChildren = document.createElement('div');
                    dirChildren.className = 'tree-children';
                    parentElement.appendChild(dirChildren);
                    
                    // „Éá„Ç£„É¨„ÇØ„Éà„É™„Éà„Ç∞„É´„Ç§„Éô„É≥„Éà
                    dirItem.querySelector('.tree-toggle').addEventListener('click', (e) => {
                        e.stopPropagation();
                        dirChildren.classList.toggle('expanded');
                        e.target.textContent = dirChildren.classList.contains('expanded') ? '‚ñº' : '‚ñ∂';
                    });
                    
                    // Â≠ê„Éá„Ç£„É¨„ÇØ„Éà„É™„ÇíÂÜçÂ∏∞ÁöÑ„Å´ÊßãÁØâ
                    buildTreeFromMap(map[dirName], dirChildren);
                    
                    // „Åì„ÅÆ„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆ„Éï„Ç°„Ç§„É´„ÇíËøΩÂä†
                    map[dirName]._files.forEach(file => {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'tree-item file';
                        fileItem.setAttribute('data-file', file.path);
                        
                        // „Éï„Ç°„Ç§„É´„ÅÆÊã°ÂºµÂ≠ê„Å´Âü∫„Å•„ÅÑ„Å¶„Ç¢„Ç§„Ç≥„É≥„ÇíË®≠ÂÆö
                        const fileExt = file.name.split('.').pop().toLowerCase();
                        let iconClass = 'file';
                        
                        if (fileExt === 'html') iconClass = 'html';
                        else if (fileExt === 'css') iconClass = 'css';
                        else if (fileExt === 'js') iconClass = 'js';
                        
                        fileItem.innerHTML = `
                            <span class="file-icon ${iconClass}"></span>
                            <span>${file.name}</span>
                        `;
                        
                        dirChildren.appendChild(fileItem);
                        
                        // „Éï„Ç°„Ç§„É´„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
                        fileItem.addEventListener('click', () => {
                            openFile(file.path);
                            
                            // „ÉÑ„É™„Éº„Ç¢„Ç§„ÉÜ„É†„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                            document.querySelectorAll('.tree-item').forEach(i => i.classList.remove('active'));
                            fileItem.classList.add('active');
                        });
                    });
                });
            }
            
            // „É´„Éº„Éà„É¨„Éô„É´„ÅÆ„Éï„Ç°„Ç§„É´Ôºà„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´„Å™„ÅÑ„ÇÇ„ÅÆÔºâ„ÇíËøΩÂä†
            Object.keys(customFiles).forEach(filePath => {
                if (!filePath.includes('/')) {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'tree-item file';
                    fileItem.setAttribute('data-file', filePath);
                    
                    const fileExt = filePath.split('.').pop().toLowerCase();
                    let iconClass = 'file';
                    
                    if (fileExt === 'html') iconClass = 'html';
                    else if (fileExt === 'css') iconClass = 'css';
                    else if (fileExt === 'js') iconClass = 'js';
                    
                    fileItem.innerHTML = `
                        <span class="file-icon ${iconClass}"></span>
                        <span>${filePath}</span>
                    `;
                    
                    rootChildren.appendChild(fileItem);
                    
                    // „Éï„Ç°„Ç§„É´„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
                    fileItem.addEventListener('click', () => {
                        openFile(filePath);
                        
                        // „ÉÑ„É™„Éº„Ç¢„Ç§„ÉÜ„É†„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                        document.querySelectorAll('.tree-item').forEach(i => i.classList.remove('active'));
                        fileItem.classList.add('active');
                    });
                }
            });
            
            // „Éá„Ç£„É¨„ÇØ„Éà„É™„ÉÑ„É™„Éº„ÇíÊßãÁØâ
            buildTreeFromMap(dirMap, rootChildren);
        }
        
        // „Éó„É¨„Éì„É•„ÉºË°®Á§∫
        previewBtn.addEventListener('click', () => {
            // „Ç®„Éá„Ç£„Çø„Éº„ÅÆÂÜÖÂÆπ„ÇíÊõ¥Êñ∞
            saveCurrentFile();
            
            // „Éó„É¨„Éì„É•„Éº„ÇíÁîüÊàê„Åó„Å¶Ë°®Á§∫
            generatePreview();
            popupOverlay.style.display = 'flex';
            
            // „Éá„Éê„Ç§„Çπ„Çµ„Ç§„Ç∫„ÅÆÂàùÊúüË®≠ÂÆö„ÇíÈÅ©Áî®
            updatePreviewSize();
        });
        
        // „Éó„É¨„Éì„É•„Éº„Çµ„Ç§„Ç∫„ÅÆÊõ¥Êñ∞
        deviceSelector.addEventListener('change', updatePreviewSize);
        
        function updatePreviewSize() {
            const device = deviceSelector.value;
            const iframe = document.getElementById('preview-frame');
            
            switch (device) {
                case 'mobile':
                    iframe.style.width = '375px';
                    iframe.style.height = '667px';
                    break;
                case 'tablet':
                    iframe.style.width = '768px';
                    iframe.style.height = '1024px';
                    break;
                default:
                    iframe.style.width = '100%';
                    iframe.style.height = '100%';
                    break;
            }
        }
        
        // „Éó„É¨„Éì„É•„Éº„ÇíÈñâ„Åò„Çã
        closePopupBtn.addEventListener('click', () => {
            popupOverlay.style.display = 'none';
        });
        
        // Â§ñÂÅ¥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„ÇÇ„Éó„É¨„Éì„É•„Éº„ÇíÈñâ„Åò„Çâ„Çå„Çã„Çà„ÅÜ„Å´
        popupOverlay.addEventListener('click', (e) => {
            if (e.target === popupOverlay) {
                popupOverlay.style.display = 'none';
            }
        });
        
        // „Éó„É¨„Éì„É•„Éº„ÅÆÁîüÊàê
        function generatePreview() {
            const iframe = document.getElementById('preview-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            // iframe„ÅÆÂÜÖÂÆπ„Çí„ÇØ„É™„Ç¢
            iframeDoc.open();
            
            // Blob„Çí‰ΩøÁî®„Åó„Å¶„Éï„Ç°„Ç§„É´URL„Çí‰ΩúÊàê
            const htmlBlob = new Blob([files['index.html']], { type: 'text/html' });
            const cssBlob = new Blob([files['style.css']], { type: 'text/css' });
            const jsBlob = new Blob([files['script.js']], { type: 'text/javascript' });
            
            // „É°„Ç§„É≥„Éï„Ç°„Ç§„É´„ÅÆURL„Çí‰ΩúÊàê
            const htmlUrl = URL.createObjectURL(htmlBlob);
            const cssUrl = URL.createObjectURL(cssBlob);
            const jsUrl = URL.createObjectURL(jsBlob);
            
            // „Ç´„Çπ„Çø„É†„Éï„Ç°„Ç§„É´„ÅÆURL„Çí‰ΩúÊàê
            const customFileUrls = {};
            Object.keys(customFiles).forEach(filePath => {
                const fileType = filePath.split('.').pop().toLowerCase();
                let mimeType = 'text/plain';
                
                if (fileType === 'css') {
                    mimeType = 'text/css';
                } else if (fileType === 'js') {
                    mimeType = 'text/javascript';
                } else if (fileType === 'html') {
                    mimeType = 'text/html';
                }
                
                const blob = new Blob([customFiles[filePath]], { type: mimeType });
                customFileUrls[filePath] = URL.createObjectURL(blob);
            });
            
            // „Ç´„Çπ„Çø„É†„Éï„Ç°„Ç§„É´„Å∏„ÅÆÂèÇÁÖß„ÇíÁΩÆ„ÅçÊèõ„Åà
            let htmlContent = files['index.html'];
            
            // style.css„Å®script.js„ÅÆÂèÇÁÖß„ÇíÁΩÆ„ÅçÊèõ„Åà
            htmlContent = htmlContent.replace(/href\s*=\s*["']style\.css["']/g, `href="${cssUrl}"`);
            htmlContent = htmlContent.replace(/src\s*=\s*["']script\.js["']/g, `src="${jsUrl}"`);
            
            // „Ç´„Çπ„Çø„É†„Éï„Ç°„Ç§„É´„ÅÆÂèÇÁÖß„ÇíÁΩÆ„ÅçÊèõ„Åà
            Object.keys(customFileUrls).forEach(filePath => {
                const escapedPath = filePath.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp('(href|src)\\s*=\\s*["\']' + escapedPath + '["\']', 'g');
                htmlContent = htmlContent.replace(regex, `$1="${customFileUrls[filePath]}"`);
            });
            
            // HTML„Çíiframe„Å´Êõ∏„ÅçËæº„ÇÄ
            iframeDoc.write(htmlContent);
            iframeDoc.close();
        }
    </script>
</body>
</html>
