<!DOCTYPE html>
<html>
	<head>
		<title>コードエディター</title>
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=Noto+Sans+JP&display=swap" rel="stylesheet">
		<style>
			html, body {
				margin: 0;
				padding: 0;
				color: #333333;
			}
			.container {
			      margin: 0;
			      height: 100vh;
			      background: linear-gradient(135deg, #1e3c72, #2a5298, #1e90ff, #87cefa);
			      background-size: 100% 100%;
			      font-family: "Fira Code", monospace;
			}
			.menubar {
				height: 30px;
				width: 100%;
				background-color: rgb(255,255,255,0.8);
				display: flex;
				align-items: center;
				justify-content: space-around;
				font-size: 1.0em;
			}
			.edit-container {
				height: 85%;
				margin: 2.5% 2.5%;
				width: 95%;
				background-color: rgb(255,255,255,0.3);
				border-radius: 20px;
			}
			.filename-cards {
				width: 100%;
				height: 30px;
				display: flex;
				align-items: center;
				justify-content: flex-start;
				border-top-left-radius: 20px;
				border-top-right-radius: 20px;
			}
			.filename-card {
				background-color: rgb(255,255,255,0.5);
				border-bottom: 1px solid rgb(255,255,255,1.0);
				height: 100%;
				padding: 0 30px;
				display: flex;
				align-items: center;
			}
			.first {
				border-top-left-radius: 20px;
			}
			.fileHTML {
				color: red;
			}
			.editarea {
				height: calc(100% - 30px);
				width: 100%;
				display: flex;
				background-color: rgb(255,255,255,0.5);
				font-size: 15px;
				border-bottom-left-radius: 20px;
				border-bottom-right-radius: 20px;
				overflow: hidden; /* ← スクロール制御のために一度隠す */
			}

			.edittext {
				height: calc(100% - 30px);
				width: 100%;
				overflow-y: auto; /* ← 縦スクロールを有効に */
				margin: 10px 20px;
				padding-right: 10px; /* ← スクロールバーと文字がかぶらないように */
			}
			.programtext {
				padding: 0;
				margin: 0;
				font-size: 0.9em;
				white-space: pre;
				color: rgb(150,150,150,1)
			}
			.canvas {
			}
		</style>
	</head>
	<body>
		<canvas width=window.width height=window.height id="canvas"></canvas>
		<div class="container">
			<div class="menubar">
				<span>ファイル</span>
				<span>検索</span>
				<span>設定</span>
			</div>
			<div class="edit-container">
				<div class="filename-cards">
					<div class="filename-card first">
						<span>index.<span class="fileHTML">html</span></span>
					</div>
				</div>
				<div class="editarea">
					<div class="edittext">
						<p>hello</p>
						<p>はわゆ</p>
					</div>
				</div>
			</div>
		</div>
	<script>
		let text = [
			"",
		];
		let lineText = [
			"",
		]
		let displayText = [
			"",
		]
		let editPoint = { x: 0, y: 0, }
		document.addEventListener('keydown',keydown);
		
		async function keydown(e) {
			if(e.key == "Enter" || e.key == "ArrowDown" || e.key == "ArrowUp" || e.key == "ArrowRight" || e.key == "Shift" || e.key == "Backspace") {
				if(e.key == 'Enter') {
					text.push("");
					editPoint.y++;
					editPoint.x = 0;
				}
				if(e.key == "ArrowDown") {
					if(editPoint.y >= text.length - 1 ) {
						
					} else {
						editPoint.y++
						if (editPoint.x >= text[editPoint.y].length - 1) {
							editPoint.x = text[editPoint.y].length - 1;
						}
					}
				}
				if(e.key == "ArrowUp") {
					if(editPoint.y > 0 ) {
						editPoint.y--
						if (editPoint.x >= text[editPoint.y].length - 1) {
							editPoint.x = text[editPoint.y].length - 1;
						}
					}
				}
				if(e.key == "ArrowRight") {
					if(editPoint.x >= text[editPoint.y].length - 1 ) {
						editPoint.x++
					}
				}
			} else {
				text[editPoint.y] = text[editPoint.y].slice(0, editPoint.x) + e.key + text[editPoint.y].slice(editPoint.x, text[editPoint.y].length);
				editPoint.x++
			}
			drawText();
		}
		function sleep(ms) {
		}
		function drawText() {
			let editText = document.querySelector(".edittext");
			editText.innerHTML = "";
			for(i=0;i<text.length;i++) {
				let p = document.createElement("p");
				p.className = "programtext"
				let space = "";
				if ((i + 1) < 10) {
					space = "   ";
				} else if ((i + 1) < 100) {
					space = "  "
				} else if ((i + 1) < 1000) {
					space = " ";
				} else if ((i + 1) < 10000) {
					space = "";
				}
				p.innerText = space + (i + 1) + "   " +  text[i]
				p.dataset.line = i
				editText.appendChild(p);
			}
		}
		
		document.querySelector(".edittext").addEventListener("click", handleClick);
		
		function handleClick(e) {
				const target = e.target;
				if (!target.classList.contains("programtext")) return;
				
				const lineIndex = parseInt(target.dataset.line);
				textContent = text[lineIndex];
				
				const rect = target.getBoundingClientRect();
				const offsetX = e.clientX - rect.left;
				
				const charWidth = 8.5
				let clickedIndex = Math.floor((offsetX - 40) / charWidth);
				if(clickedIndex < 0) clickedIndex = 0;
				if(clickedIndex > textContent) clickedIndex = textContent
				
				
				editPoint.y = lineIndex;
				editPoint.x = clickedIndex;

				drawText();
		}
	</script>
	</body>
</html>
