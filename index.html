<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ with ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Noto+Sans+JP:wght@400;500;700&display=swap">
    <style>
        :root {
            --bg-color: #1e1e1e;
            --sidebar-bg: #252526;
            --editor-bg: #1e1e1e;
            --tab-bg: #2d2d2d;
            --tab-active-bg: #1e1e1e;
            --tab-border: #252526;
            --text-color: #d4d4d4;
            --text-secondary: #a0a0a0;
            --accent-color: #0078d4;
            --border-color: #3e3e42;
            --button-bg: #0078d4;
            --button-hover: #106ebe;
            --button-secondary-bg: #3a3a3a;
            --button-secondary-hover: #505050;
            --tree-item-hover: #37373d;
            --tree-item-active: #094771;
            --border-radius: 8px;
            --border-radius-sm: 4px;
            --shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
            
            /* è¨€èªã”ã¨ã®ã‚«ãƒ©ãƒ¼ */
            --html-color: #e44d26;
            --css-color: #42a5f5;
            --js-color: #f7df1e;
            --json-color: #7cae3b;
            --md-color: #51a7f9;
            --default-color: #a0a0a0;
            
            /* ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆç”¨ã®è‰²ï¼ˆ3è‰²ã«é™å®šï¼‰ */
            --syntax-red: #ff4d4f;
            --syntax-blue: #1890ff;
            --syntax-yellow: #fadb14;
        }

        * {
            box-sizing: border-box;
            font-family: 'Noto Sans JP', sans-serif;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            margin: 0;
            padding: 16px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            margin-top: 0;
            font-weight: 400;
            color: var(--text-color);
            padding: 0 16px;
            font-family: 'Noto Sans JP', sans-serif;
        }

        .main-content {
            display: flex;
            gap: 16px;
            height: calc(100vh - 120px);
        }

        .file-sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 16px;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .directory-tree {
            flex: 1;
            overflow-y: auto;
            margin-top: 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: 8px;
        }

        .tree-item {
            margin: 4px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 6px 8px;
            border-radius: var(--border-radius-sm);
        }

        .tree-item.directory {
            font-weight: 500;
        }

        .tree-item.file {
            margin-left: 15px;
        }

        .tree-item:hover {
            background-color: var(--tree-item-hover);
        }

        .tree-item.active {
            background-color: var(--tree-item-active);
            border-radius: var(--border-radius-sm);
        }

        .tree-toggle {
            cursor: pointer;
            margin-right: 5px;
            color: var(--text-secondary);
        }

        .tree-children {
            margin-left: 15px;
            display: none;
        }

        .tree-children.expanded {
            display: block;
        }

        .editor-container {
            flex: 1;
            background-color: var(--editor-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding: 8px 8px 8px 4px;
        }

        .file-tabs {
            display: flex;
            gap: 1px;
            flex-wrap: wrap;
            max-width: 70%;
            position: relative;
            margin-bottom: -1px;
        }

        .file-tab {
            padding: 8px 16px;
            background-color: var(--tab-bg);
            border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
            cursor: pointer;
            position: relative;
            max-width: 160px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 13px;
            transition: background-color 0.2s ease;
            border-right: 1px solid var(--tab-border);
        }

        .file-tab.active {
            background-color: var(--tab-active-bg);
            border-bottom: 2px solid;
        }

        /* å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã”ã¨ã®è‰²åˆ†ã‘ */
        .file-tab[data-type="html"] {
            border-bottom-color: var(--syntax-red);
        }
        
        .file-tab[data-type="css"] {
            border-bottom-color: var(--syntax-blue);
        }
        
        .file-tab[data-type="js"] {
            border-bottom-color: var(--syntax-yellow);
        }
        
        .file-tab[data-type="json"] {
            border-bottom-color: var(--syntax-yellow);
        }
        
        .file-tab[data-type="md"] {
            border-bottom-color: var(--syntax-blue);
        }
        
        .file-tab:not([data-type="html"]):not([data-type="css"]):not([data-type="js"]):not([data-type="json"]):not([data-type="md"]) {
            border-bottom-color: var(--default-color);
        }

        /* ãƒ•ã‚¡ã‚¤ãƒ«åã®æ‹¡å¼µå­éƒ¨åˆ†ã®ã‚«ãƒ©ãƒ¼ */
        .file-extension {
            opacity: 0.6;
        }

        .file-tab .close-tab {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            opacity: 0.7;
            cursor: pointer;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .file-tab .close-tab:hover {
            opacity: 1;
            background-color: var(--tree-item-hover);
        }

        .editor-buttons {
            display: flex;
            gap: 8px;
        }

        button {
            padding: 8px 16px;
            background-color: var(--button-bg);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 13px;
            font-family: 'Noto Sans JP', sans-serif;
        }

        button:hover {
            background-color: var(--button-hover);
        }

        button.secondary {
            background-color: var(--button-secondary-bg);
            color: var(--text-color);
        }

        button.secondary:hover {
            background-color: var(--button-secondary-hover);
        }

        textarea {
            width: 100%;
            height: 100%;
            padding: 16px;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            line-height: 1.6;
            border: none;
            border-radius: var(--border-radius-sm);
            resize: none;
            tab-size: 4;
            color: var(--text-color);
            background-color: var(--editor-bg);
            outline: none;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .preview-popup {
            background-color: var(--bg-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 90%;
            height: 90%;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .popup-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--sidebar-bg);
        }

        .preview-controls {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .preview-controls h2 {
            margin: 0;
            font-weight: 400;
            font-size: 16px;
            font-family: 'Noto Sans JP', sans-serif;
        }

        .device-selector {
            padding: 6px 12px;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--border-color);
            background-color: var(--button-secondary-bg);
            color: var(--text-color);
            font-size: 13px;
            font-family: 'Noto Sans JP', sans-serif;
        }

        .close-popup {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-color);
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-popup:hover {
            background-color: var(--tree-item-hover);
        }

        .preview-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 24px;
            background-color: var(--bg-color);
            overflow: auto;
        }

        #preview-frame {
            border: none;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            background-color: white;
            border-radius: var(--border-radius-sm);
        }

        .file-input {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            padding: 8px;
            background-color: var(--sidebar-bg);
            border-radius: var(--border-radius-sm);
        }

        .file-input input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            background-color: var(--editor-bg);
            color: var(--text-color);
            font-family: 'Noto Sans JP', sans-serif;
        }

        .file-input select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            background-color: var(--editor-bg);
            color: var(--text-color);
            font-family: 'Noto Sans JP', sans-serif;
        }

        .file-input button {
            white-space: nowrap;
        }

        .hidden {
            display: none;
        }

        .file-manager {
            margin-top: 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: 12px;
            background-color: var(--sidebar-bg);
        }

        .file-list {
            margin-top: 12px;
            max-height: 150px;
            overflow-y: auto;
            border-radius: var(--border-radius-sm);
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .file-actions button {
            padding: 2px 8px;
            font-size: 12px;
        }

        /* ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºç”¨ */
        .file-icon {
            margin-right: 8px;
            width: 16px;
            height: 16px;
            display: inline-block;
        }

        .file-icon.html:before {
            content: "ğŸŒ";
        }

        .file-icon.css:before {
            content: "ğŸ¨";
        }

        .file-icon.js:before {
            content: "ğŸ“œ";
        }

        .file-icon.folder:before {
            content: "ğŸ“";
        }

        .file-icon.file:before {
            content: "ğŸ“„";
        }

        .bottom-bar {
            margin-top: auto;
            padding: 8px 12px;
            background-color: var(--sidebar-bg);
            border-radius: var(--border-radius-sm);
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'Noto Sans JP', sans-serif;
        }

        .import-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--editor-bg);
            border-radius: var(--border-radius-sm);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--button-secondary-bg);
            border-radius: var(--border-radius-sm);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--button-secondary-hover);
        }

        /* ã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
        .editor-content {
            flex: 1;
            position: relative;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
        }

        /* ã‚³ãƒ¼ãƒ‰ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        .syntax-highlight {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 16px;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: transparent;
            tab-size: 4;
            white-space: pre-wrap;
            overflow: auto;
            pointer-events: none;
            z-index: 0;
            background-color: var(--editor-bg);
        }

        /* èµ¤ãƒ»é’ãƒ»é»„ã®3è‰²ã«é™å®šã—ãŸã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        /* HTMLæ§‹æ–‡ */
        .html-tag {
            color: var(--syntax-blue);
        }
        .html-attr {
            color: var(--syntax-yellow);
        }
        .html-string {
            color: var(--syntax-red);
        }

        /* CSSæ§‹æ–‡ */
        .css-property {
            color: var(--syntax-blue);
        }
        .css-value {
            color: var(--syntax-red);
        }
        .css-selector {
            color: var(--syntax-yellow);
        }

        /* JSæ§‹æ–‡ */
        .js-keyword {
            color: var(--syntax-blue);
        }
        .js-string {
            color: var(--syntax-red);
        }
        .js-number {
            color: var(--syntax-yellow);
        }

        /* ã‚³ãƒ¡ãƒ³ãƒˆã¯å‰Šé™¤ï¼ˆè‰²ä»˜ãã®ã¿è¡¨ç¤ºï¼‰ */
        .html-comment, .css-comment, .js-comment {
            display: none;
        }

        /* æ—¥ä»˜ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚¨ãƒªã‚¢ */
        .user-info {
            position: absolute;
            top: 4px;
            right: 16px;
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'Noto Sans JP', sans-serif;
        }
    </style>
</head>
<body>
    <div class="user-info">
        <div>æ—¥æ™‚: 2025-04-11 23:31:31 (UTC)</div>
        <div>ãƒ¦ãƒ¼ã‚¶ãƒ¼: mituki1234</div>
    </div>
    
    <div class="container">
        <h1>ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ with ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h1>
        
        <div class="main-content">
            <div class="file-sidebar">
                <div class="import-controls">
                    <button id="import-dir-btn">ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                    <input type="file" id="dir-input" webkitdirectory directory multiple class="hidden">
                </div>
                
                <div class="directory-tree" id="directory-tree">
                    <div class="tree-item directory">
                        <span class="tree-toggle">â–¶</span>
                        <span class="file-icon folder"></span>
                        <span>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</span>
                    </div>
                    <div class="tree-children">
                        <div class="tree-item file active" data-file="index.html">
                            <span class="file-icon html"></span>
                            <span>index.html</span>
                        </div>
                        <div class="tree-item file" data-file="style.css">
                            <span class="file-icon css"></span>
                            <span>style.css</span>
                        </div>
                        <div class="tree-item file" data-file="script.js">
                            <span class="file-icon js"></span>
                            <span>script.js</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="editor-container">
                <div class="editor-header">
                    <div class="file-tabs" id="file-tabs">
                        <div class="file-tab active" data-file="index.html" data-type="html">index<span class="file-extension">.html</span></div>
                        <div class="file-tab" data-file="style.css" data-type="css">style<span class="file-extension">.css</span></div>
                        <div class="file-tab" data-file="script.js" data-type="js">script<span class="file-extension">.js</span></div>
                    </div>
                    
                    <div class="editor-buttons">
                        <button id="add-file-btn">ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ </button>
                        <button id="preview-btn">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º</button>
                    </div>
                </div>
                
                <div class="file-input hidden">
                    <input type="text" id="file-path" placeholder="ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ (ä¾‹: styles/main.css)">
                    <select id="file-type">
                        <option value="css">CSS</option>
                        <option value="js">JavaScript</option>
                        <option value="html">HTML</option>
                    </select>
                    <button id="save-file-btn">ä¿å­˜</button>
                    <button id="cancel-file-btn" class="secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
                
                <div class="editor-content">
                    <div id="html-highlight" class="syntax-highlight"></div>
                    <textarea id="html-editor" placeholder="HTMLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                    
                    <div id="css-highlight" class="syntax-highlight hidden"></div>
                    <textarea id="css-editor" class="hidden" placeholder="CSSã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                    
                    <div id="js-highlight" class="syntax-highlight hidden"></div>
                    <textarea id="js-editor" class="hidden" placeholder="JavaScriptã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                    
                    <div id="custom-highlight" class="syntax-highlight hidden"></div>
                    <textarea id="custom-editor" class="hidden" placeholder="ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                </div>
                
                <div class="bottom-bar">
                    <span id="current-file">ç¾åœ¨ç·¨é›†ä¸­: index.html</span>
                </div>
            </div>
        </div>
    </div>

    <div class="popup-overlay" id="popup-overlay">
        <div class="preview-popup">
            <div class="popup-header">
                <div class="preview-controls">
                    <h2>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                    <select id="device-selector" class="device-selector">
                        <option value="desktop">ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— (100%)</option>
                        <option value="tablet">ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ (768px)</option>
                        <option value="mobile">ãƒ¢ãƒã‚¤ãƒ« (375px)</option>
                    </select>
                </div>
                <button class="close-popup" id="close-popup">&times;</button>
            </div>
            <div class="preview-container" id="preview-container">
                <iframe id="preview-frame"></iframe>
            </div>
        </div>
    </div>

    <script>
        // ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
        const files = {
            'index.html': '',
            'style.css': '',
            'script.js': ''
        };
        
        const customFiles = {};
        let currentEditingFile = 'index.html';
        let activeEditor = 'html-editor';
        let isDirectoryImported = false;
        
        // DOMè¦ç´ 
        const htmlEditor = document.getElementById('html-editor');
        const cssEditor = document.getElementById('css-editor');
        const jsEditor = document.getElementById('js-editor');
        const customEditor = document.getElementById('custom-editor');
        const htmlHighlight = document.getElementById('html-highlight');
        const cssHighlight = document.getElementById('css-highlight');
        const jsHighlight = document.getElementById('js-highlight');
        const customHighlight = document.getElementById('custom-highlight');
        const fileTabs = document.querySelectorAll('.file-tab');
        const fileTabsContainer = document.getElementById('file-tabs');
        const previewBtn = document.getElementById('preview-btn');
        const popupOverlay = document.getElementById('popup-overlay');
        const closePopupBtn = document.getElementById('close-popup');
        const previewFrame = document.getElementById('preview-frame');
        const addFileBtn = document.getElementById('add-file-btn');
        const fileInput = document.querySelector('.file-input');
        const filePathInput = document.getElementById('file-path');
        const fileTypeSelect = document.getElementById('file-type');
        const saveFileBtn = document.getElementById('save-file-btn');
        const cancelFileBtn = document.getElementById('cancel-file-btn');
        const directoryTree = document.getElementById('directory-tree');
        const deviceSelector = document.getElementById('device-selector');
        const previewContainer = document.getElementById('preview-container');
        const currentFileDisplay = document.getElementById('current-file');
        const importDirBtn = document.getElementById('import-dir-btn');
        const dirInput = document.getElementById('dir-input');
        
        // åˆæœŸè¨­å®š
        htmlEditor.value = '<!DOCTYPE html>\n<html>\n<head>\n  <title>ãƒã‚¤ãƒšãƒ¼ã‚¸</title>\n  <link rel="stylesheet" href="style.css">\n  <script src="script.js"><\/script>\n</head>\n<body>\n  <h1>ã‚ˆã†ã“ãï¼</h1>\n  <p>ã“ã‚Œã¯ç°¡å˜ãªHTMLãƒšãƒ¼ã‚¸ã§ã™ã€‚</p>\n  <div class="container">\n    <button id="myButton">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã­</button>\n  </div>\n</body>\n</html>';
        cssEditor.value = 'body {\n  font-family: Arial, sans-serif;\n  margin: 20px;\n  background-color: #f0f0f0;\n}\n\nh1 {\n  color: #333;\n  text-align: center;\n}';
        jsEditor.value = 'document.addEventListener("DOMContentLoaded", function() {\n  console.log("ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸï¼");\n});';
        
        files['index.html'] = htmlEditor.value;
        files['style.css'] = cssEditor.value;
        files['script.js'] = jsEditor.value;
        
        // ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æ›´æ–°
        updateHighlight('html', htmlEditor.value);
        updateHighlight('css', cssEditor.value);
        updateHighlight('js', jsEditor.value);
        
        // ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã«åŸºã¥ãã‚¿ã‚¤ãƒ—ã‚’å–å¾—ã™ã‚‹é–¢æ•°
        function getFileType(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            return ext;
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ‹¡å¼µå­ã¨ãƒ™ãƒ¼ã‚¹åã«åˆ†å‰²ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function formatFileNameForTab(fileName) {
            const parts = fileName.split('.');
            const ext = parts.pop();
            const baseName = parts.join('.');
            return `${baseName}<span class="file-extension">.${ext}</span>`;
        }
        
        // HTMLæ§‹æ–‡ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆèµ¤ãƒ»é’ãƒ»é»„ã®3è‰²ã®ã¿ï¼‰
        function highlightHTML(code) {
            // ã‚¿ã‚°ã€å±æ€§ã€æ–‡å­—åˆ—ã®ã¿ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            return code
                .replace(/(&lt;\/?[a-zA-Z0-9-]+)/g, '<span class="html-tag">$1</span>')
                .replace(/([a-zA-Z0-9-]+)=(&quot;|&apos;)/g, '<span class="html-attr">$1</span>=<span class="html-string">$2</span>')
                .replace(/(&quot;.*?&quot;|&apos;.*?&apos;)/g, '<span class="html-string">$1</span>');
        }
        
        // CSSæ§‹æ–‡ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆèµ¤ãƒ»é’ãƒ»é»„ã®3è‰²ã®ã¿ï¼‰
        function highlightCSS(code) {
            // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€å€¤ã€ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ã¿ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            return code
                .replace(/([a-zA-Z-]+:)/g, '<span class="css-property">$1</span>')
                .replace(/(:[^;]+)/g, function(match) {
                    return match.replace(/([^:]+)/g, '<span class="css-value">$1</span>');
                })
                .replace(/([.#]?[a-zA-Z0-9-_]+)(?=\s*\{)/g, '<span class="css-selector">$1</span>');
        }
        
        // JavaScriptæ§‹æ–‡ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆèµ¤ãƒ»é’ãƒ»é»„ã®3è‰²ã®ã¿ï¼‰
        function highlightJS(code) {
            // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€æ–‡å­—åˆ—ã€æ•°å€¤ã®ã¿ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            const keywords = ['var', 'let', 'const', 'function', 'return', 'if', 'else', 'for', 'while', 'do', 'switch', 'case', 'break', 'continue', 'new', 'this', 'typeof'];
            let highlightedCode = code
                .replace(/(".*?"|'.*?'|`[\s\S]*?`)/g, '<span class="js-string">$1</span>')
                .replace(/\b(\d+(\.\d+)?)\b/g, '<span class="js-number">$1</span>');
            
            // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            keywords.forEach(keyword => {
                const re = new RegExp('\\b(' + keyword + ')\\b', 'g');
                highlightedCode = highlightedCode.replace(re, '<span class="js-keyword">$1</span>');
            });
            
            return highlightedCode;
        }
        
        // ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã®æ›´æ–°é–¢æ•°
        function updateHighlight(type, code) {
            let highlightElement;
            let highlightedCode = escapeHTML(code);
            
            switch(type) {
                case 'html':
                    highlightElement = htmlHighlight;
                    highlightedCode = highlightHTML(highlightedCode);
                    break;
                case 'css':
                    highlightElement = cssHighlight;
                    highlightedCode = highlightCSS(highlightedCode);
                    break;
                case 'js':
                    highlightElement = jsHighlight;
                    highlightedCode = highlightJS(highlightedCode);
                    break;
                default:
                    // ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ‡ã‚£ã‚¿ã®å ´åˆã¯æ‹¡å¼µå­ã«åŸºã¥ã„ã¦é©åˆ‡ãªãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’é©ç”¨
                    highlightElement = customHighlight;
                    const fileExt = currentEditingFile.split('.').pop().toLowerCase();
                    if (fileExt === 'html') {
                        highlightedCode = highlightHTML(highlightedCode);
                    } else if (fileExt === 'css') {
                        highlightedCode = highlightCSS(highlightedCode);
                    } else if (fileExt === 'js') {
                        highlightedCode = highlightJS(highlightedCode);
                    }
                    break;
            }
            
            if (highlightElement) {
                highlightElement.innerHTML = highlightedCode;
                highlightElement.scrollTop = highlightElement.parentElement.querySelector('textarea').scrollTop;
            }
        }
        
        // HTMLç‰¹æ®Šæ–‡å­—ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
        function escapeHTML(text) {
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&apos;");
        }
        
        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®åŒæœŸ
        [htmlEditor, cssEditor, jsEditor, customEditor].forEach(editor => {
            editor.addEventListener('scroll', function() {
                const highlightDiv = this.previousElementSibling;
                if (highlightDiv) {
                    highlightDiv.scrollTop = this.scrollTop;
                    highlightDiv.scrollLeft = this.scrollLeft;
                }
            });
            
            // å…¥åŠ›æ™‚ã«ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æ›´æ–°
            editor.addEventListener('input', function() {
                if (editor === htmlEditor) {
                    updateHighlight('html', editor.value);
                } else if (editor === cssEditor) {
                    updateHighlight('css', editor.value);
                } else if (editor === jsEditor) {
                    updateHighlight('js', editor.value);
                } else if (editor === customEditor) {
                    updateHighlight('custom', editor.value);
                }
                saveCurrentFile();
            });
        });
        
        // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ„ãƒªãƒ¼ã®ãƒˆã‚°ãƒ«
        document.querySelectorAll('.tree-toggle').forEach(toggle => {
            toggle.addEventListener('click', (e) => {
                const parent = e.target.parentElement;
                const children = parent.nextElementSibling;
                
                if (children && children.classList.contains('tree-children')) {
                    children.classList.toggle('expanded');
                    e.target.textContent = children.classList.contains('expanded') ? 'â–¼' : 'â–¶';
                }
            });
        });
        
        // åˆæœŸè¡¨ç¤ºã®ãŸã‚ã«ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ãƒ„ãƒªãƒ¼ã‚’å±•é–‹
        document.querySelector('.tree-toggle').click();
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ„ãƒªãƒ¼ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
        function setupFileTreeListeners() {
            document.querySelectorAll('.tree-item.file').forEach(item => {
                item.addEventListener('click', () => {
                    const filePath = item.getAttribute('data-file');
                    openFile(filePath);
                    
                    // ãƒ„ãƒªãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                    document.querySelectorAll('.tree-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                });
            });
        }
        
        setupFileTreeListeners();
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
        function setupTabListeners() {
            document.querySelectorAll('.file-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const filePath = tab.getAttribute('data-file');
                    openFile(filePath);
                });
            });
        }
        
        setupTabListeners();
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãé–¢æ•°
        function openFile(filePath) {
            // ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ä¿å­˜
            saveCurrentFile();
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.file-tab').forEach(t => t.classList.remove('active'));
            let tabToActivate = document.querySelector(`.file-tab[data-file="${filePath}"]`);
            
            if (!tabToActivate) {
                // ã‚¿ãƒ–ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯æ–°ã—ãä½œæˆ
                addFileTab(filePath);
                tabToActivate = document.querySelector(`.file-tab[data-file="${filePath}"]`);
            }
            
            if (tabToActivate) {
                tabToActivate.classList.add('active');
            }
            
            // ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å‰ã«ã™ã¹ã¦ã®ã‚¨ãƒ‡ã‚£ã‚¿ã¨ãƒã‚¤ãƒ©ã‚¤ãƒˆè¦ç´ ã‚’éè¡¨ç¤ºã«ã™ã‚‹
            document.querySelectorAll('.syntax-highlight').forEach(h => h.classList.add('hidden'));
            document.querySelectorAll('textarea').forEach(t => t.classList.add('hidden'));
            
            // ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã§åˆ¤æ–­
            const fileExt = filePath.split('.').pop().toLowerCase();
            let editorToShow;
            let highlightToShow;
            
            if (filePath === 'index.html' && !isDirectoryImported) {
                editorToShow = htmlEditor;
                highlightToShow = htmlHighlight;
                activeEditor = 'html-editor';
                updateHighlight('html', htmlEditor.value);
            } else if (filePath === 'style.css' && !isDirectoryImported) {
                editorToShow = cssEditor;
                highlightToShow = cssHighlight;
                activeEditor = 'css-editor';
                updateHighlight('css', cssEditor.value);
            } else if (filePath === 'script.js' && !isDirectoryImported) {
                editorToShow = jsEditor;
                highlightToShow = jsHighlight;
                activeEditor = 'js-editor';
                updateHighlight('js', jsEditor.value);
            } else {
                // ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚¡ã‚¤ãƒ«
                editorToShow = customEditor;
                highlightToShow = customHighlight;
                activeEditor = 'custom-editor';
                
                // ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒåŸºæœ¬ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒåã ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã‚‚ã®ãªã‚‰ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸå†…å®¹ã‚’ä½¿ç”¨
                if (isDirectoryImported && (filePath === 'index.html' || filePath === 'style.css' || filePath === 'script.js')) {
                    customEditor.value = customFiles[filePath] || '';
                } else {
                    // ãã®ä»–ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ãƒ­ãƒ¼ãƒ‰
                    customEditor.value = customFiles[filePath] || '';
                }
                
                updateHighlight('custom', customEditor.value);
            }
            
            if (editorToShow) {
                editorToShow.classList.remove('hidden');
            }
            
            if (highlightToShow) {
                highlightToShow.classList.remove('hidden');
            }
            
            currentEditingFile = filePath;
            
            // ç¾åœ¨ç·¨é›†ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤ºã‚’æ›´æ–°
            currentFileDisplay.textContent = `ç¾åœ¨ç·¨é›†ä¸­: ${filePath}`;
        }
        
        // ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
        function saveCurrentFile() {
            if (!isDirectoryImported && currentEditingFile === 'index.html') {
                files['index.html'] = htmlEditor.value;
            } else if (!isDirectoryImported && currentEditingFile === 'style.css') {
                files['style.css'] = cssEditor.value;
            } else if (!isDirectoryImported && currentEditingFile === 'script.js') {
                files['script.js'] = jsEditor.value;
            } else {
                // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œã¾ãŸã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
                customFiles[currentEditingFile] = activeEditor === 'custom-editor' ? 
                    customEditor.value : 
                    document.getElementById(activeEditor).value;
            }
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ãƒ–ã‚’è¿½åŠ 
        function addFileTab(filePath) {
            // æ—¢å­˜ã®ã‚¿ãƒ–ãŒã‚ã‚Œã°è¿”ã™
            const existingTab = document.querySelector(`.file-tab[data-file="${filePath}"]`);
            if (existingTab) return;
            
            const fileTab = document.createElement('div');
            fileTab.className = 'file-tab';
            fileTab.setAttribute('data-file', filePath);
            
            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã«åŸºã¥ãå±æ€§ã‚’è¨­å®š
            const fileType = getFileType(filePath);
            fileTab.setAttribute('data-type', fileType);
            
            // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—ï¼ˆãƒ‘ã‚¹ã®æœ€å¾Œã®éƒ¨åˆ†ï¼‰ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            const fileName = filePath.split('/').pop();
            
            fileTab.innerHTML = `
                ${formatFileNameForTab(fileName)}
                <span class="close-tab" data-file="${filePath}">&times;</span>
            `;
            
            fileTabsContainer.appendChild(fileTab);
            
            // ã‚¿ãƒ–ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            fileTab.addEventListener('click', () => {
                openFile(filePath);
            });
            
            // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
            fileTab.querySelector('.close-tab').addEventListener('click', (e) => {
                e.stopPropagation();
                closeFileTab(filePath);
            });
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ãƒ–ã‚’é–‰ã˜ã‚‹
        function closeFileTab(filePath) {
            const tab = document.querySelector(`.file-tab[data-file="${filePath}"]`);
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¿ãƒ–ã§ã‚‚ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸€éƒ¨ãªã‚‰é–‰ã˜ã‚‰ã‚Œã‚‹
            if (!isDirectoryImported && (filePath === 'index.html' || filePath === 'style.css' || filePath === 'script.js')) {
                return;
            }
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã‚’é–‰ã˜ã‚‹å ´åˆã¯ã€åˆ¥ã®ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
            if (tab && tab.classList.contains('active')) {
                // æ¬¡ã®ã‚¿ãƒ–ã‚’é–‹ãã‹ã€ãªã‘ã‚Œã°index.htmlã‚’é–‹ã
                const tabs = Array.from(document.querySelectorAll('.file-tab'));
                const currentIndex = tabs.indexOf(tab);
                let nextTabIndex = currentIndex + 1;
                
                if (nextTabIndex >= tabs.length) {
                    nextTabIndex = 0;
                }
                
                if (tabs.length > 1) {
                    const nextFilePath = tabs[nextTabIndex].getAttribute('data-file');
                    openFile(nextFilePath);
                } else {
                    // ã“ã‚ŒãŒæœ€å¾Œã®ã‚¿ãƒ–ãªã‚‰ä½•ã‚‚ã—ãªã„
                    return;
                }
            }
            
            // ã‚¿ãƒ–ã‚’å‰Šé™¤
            if (tab) tab.remove();
            
            // ã‚‚ã—ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ãªã‚‰ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å‰Šé™¤
            if (customFiles[filePath] && !filePath.includes('/')) {
                delete customFiles[filePath];
                // ãƒ„ãƒªãƒ¼ã‹ã‚‰ã‚‚å‰Šé™¤
                const treeItem = document.querySelector(`.tree-item.file[data-file="${filePath}"]`);
                if (treeItem) treeItem.remove();
            }
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ UIè¡¨ç¤º
        addFileBtn.addEventListener('click', () => {
            fileInput.classList.toggle('hidden');
        });
        
        // ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        cancelFileBtn.addEventListener('click', () => {
            fileInput.classList.add('hidden');
            filePathInput.value = '';
        });
        
        // æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
        saveFileBtn.addEventListener('click', () => {
            const filePath = filePathInput.value.trim();
            const fileType = fileTypeSelect.value;
            
            if (filePath) {
                // æ‹¡å¼µå­ã‚’ãƒã‚§ãƒƒã‚¯
                let extension = filePath.split('.').pop().toLowerCase();
                if (fileType === 'css' && extension !== 'css') {
                    alert('CSSãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã¯.cssã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
                    return;
                } else if (fileType === 'js' && extension !== 'js') {
                    alert('JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã¯.jsã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
                    return;
                } else if (fileType === 'html' && extension !== 'html') {
                    alert('HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã¯.htmlã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
                    return;
                }
                
                // æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
                if (files[filePath] || customFiles[filePath]) {
                    alert('ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™');
                    return;
                }
                
                // æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
                customFiles[filePath] = '';
                updateDirectoryTree();
                
                // æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
                openFile(filePath);
                
                fileInput.classList.add('hidden');
                filePathInput.value = '';
            } else {
                alert('æœ‰åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            }
        });

        // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        importDirBtn.addEventListener('click', () => {
            dirInput.click();
        });
        
        dirInput.addEventListener('change', async (e) => {
            const files = e.target.files;
            
            if (files.length > 0) {
                // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ•ãƒ©ã‚°ã‚’è¨­å®š
                isDirectoryImported = true;
                
                // ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªã‚¢ï¼ˆãƒªã‚»ãƒƒãƒˆï¼‰
                for (const key in customFiles) {
                    delete customFiles[key];
                }
                
                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ãƒ–ã‚’ã‚¯ãƒªã‚¢
                fileTabsContainer.innerHTML = '';
                
                // ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ç”¨ã®é–¢æ•°
                const readFile = (file) => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (e) => resolve(e.target.result);
                        reader.onerror = reject;
                        reader.readAsText(file);
                    });
                };
                
                // ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹HTMLã‚’è¦‹ã¤ã‘ã‚‹
                let indexHtmlPath = null;
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const path = file.webkitRelativePath;
                    
                    // ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡ã‚’åˆ¤æ–­ã—ã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                    const fileExt = path.split('.').pop().toLowerCase();
                    if (['html', 'css', 'js', 'txt', 'md', 'json', 'xml', 'svg'].includes(fileExt)) {
                        try {
                            const content = await readFile(file);
                            customFiles[path] = content;
                            
                            // index.htmlã‚’æ¢ã™
                            if (fileExt === 'html' && path.toLowerCase().includes('index.html')) {
                                if (!indexHtmlPath || path.split('/').length < indexHtmlPath.split('/').length) {
                                    indexHtmlPath = path;
                                }
                            }
                        } catch (error) {
                            console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                        }
                    }
                }
                
                // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ„ãƒªãƒ¼ã‚’æ›´æ–°
                updateDirectoryTree();
                
                // è¦‹ã¤ã‹ã£ãŸindex.htmlã‚’é–‹ãã€ãªã‘ã‚Œã°æœ€åˆã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
                if (indexHtmlPath) {
                    openFile(indexHtmlPath);
                } else {
                    // æœ€åˆã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã™
                    for (const path in customFiles) {
                        if (path.endsWith('.html')) {
                            openFile(path);
                            break;
                        }
                    }
                }
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãŒå®Œäº†ã—ãŸã‚‰å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢ã—ã¦æ¬¡å›ã‚‚åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
                dirInput.value = '';
            }
        });
        
        // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ„ãƒªãƒ¼ã‚’æ›´æ–°
        function updateDirectoryTree() {
            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
            const rootDir = directoryTree.querySelector('.tree-item.directory');
            const rootChildren = directoryTree.querySelector('.tree-children');
            rootChildren.innerHTML = '';
            
            if (!isDirectoryImported) {
                // ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
                const defaultFiles = [
                    { path: 'index.html', icon: 'html' },
                    { path: 'style.css', icon: 'css' },
                    { path: 'script.js', icon: 'js' }
                ];
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ„ãƒªãƒ¼ã«è¿½åŠ 
                defaultFiles.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'tree-item file';
                    fileItem.setAttribute('data-file', file.path);
                    fileItem.innerHTML = `
                        <span class="file-icon ${file.icon}"></span>
                        <span>${file.path}</span>
                    `;
                    rootChildren.appendChild(fileItem);
                });
            } else {
                // ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰: ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ã‚’å‡¦ç†
                const dirMap = {}; // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°
                
                // å…¨ã¦ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ„ãƒªãƒ¼æ§‹é€ ã«å¤‰æ›
                Object.keys(customFiles).sort().forEach(filePath => {
                    const segments = filePath.split('/');
                    const fileName = segments.pop();
                    let currentPath = '';
                    let currentMap = dirMap;
                    
                    // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ã‚’æ§‹ç¯‰
                    segments.forEach(segment => {
                        currentPath = currentPath ? `${currentPath}/${segment}` : segment;
                        if (!currentMap[segment]) {
                            currentMap[segment] = { _files: [], _path: currentPath };
                        }
                        currentMap = currentMap[segment];
                    });
                    
                    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è¿½åŠ 
                    currentMap._files.push({
                        name: fileName,
                        path: filePath
                    });
                });
                
                // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ„ãƒªãƒ¼ã‚’å†å¸°çš„ã«æ§‹ç¯‰
                function buildTreeFromMap(map, parentElement) {
                    // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
                    Object.keys(map).forEach(dirName => {
                        if (dirName === '_files' || dirName === '_path') return;
                        
                        const dirItem = document.createElement('div');
                        dirItem.className = 'tree-item directory';
                        dirItem.innerHTML = `
                            <span class="tree-toggle">â–¶</span>
                            <span class="file-icon folder"></span>
                            <span>${dirName}</span>
                        `;
                        parentElement.appendChild(dirItem);
                        
                        // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å­è¦ç´ ã‚³ãƒ³ãƒ†ãƒŠ
                        const dirChildren = document.createElement('div');
                        dirChildren.className = 'tree-children';
                        parentElement.appendChild(dirChildren);
                        
                        // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒˆã‚°ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆ
                        dirItem.querySelector('.tree-toggle').addEventListener('click', (e) => {
                            e.stopPropagation();
                            dirChildren.classList.toggle('expanded');
                            e.target.textContent = dirChildren.classList.contains('expanded') ? 'â–¼' : 'â–¶';
                        });
                        
                        // å­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å†å¸°çš„ã«æ§‹ç¯‰
                        buildTreeFromMap(map[dirName], dirChildren);
                        
                        // ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
                        map[dirName]._files.forEach(file => {
                            const fileItem = document.createElement('div');
                            fileItem.className = 'tree-item file';
                            fileItem.setAttribute('data-file', file.path);
                            
                            // ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã«åŸºã¥ã„ã¦ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¨­å®š
                            const fileExt = file.name.split('.').pop().toLowerCase();
                            let iconClass = 'file';
                            
                            if (fileExt === 'html') iconClass = 'html';
                            else if (fileExt === 'css') iconClass = 'css';
                            else if (fileExt === 'js') iconClass = 'js';
                            
                            fileItem.innerHTML = `
                                <span class="file-icon ${iconClass}"></span>
                                <span>${file.name}</span>
                            `;
                            
                            dirChildren.appendChild(fileItem);
                        });
                    });
                }
                
                // ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãªã„ã‚‚ã®ï¼‰ã‚’è¿½åŠ 
                Object.keys(customFiles).forEach(filePath => {
                    if (!filePath.includes('/')) {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'tree-item file';
                        fileItem.setAttribute('data-file', filePath);
                        
                        const fileExt = filePath.split('.').pop().toLowerCase();
                        let iconClass = 'file';
                        
                        if (fileExt === 'html') iconClass = 'html';
                        else if (fileExt === 'css') iconClass = 'css';
                        else if (fileExt === 'js') iconClass = 'js';
                        
                        fileItem.innerHTML = `
                            <span class="file-icon ${iconClass}"></span>
                            <span>${filePath}</span>
                        `;
                        
                        rootChildren.appendChild(fileItem);
                    }
                });
                
                // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰
                buildTreeFromMap(dirMap, rootChildren);
            }
            
            // ãƒ„ãƒªãƒ¼ã‚’å±•é–‹çŠ¶æ…‹ã«
            rootDir.querySelector('.tree-toggle').textContent = 'â–¼';
            rootChildren.classList.add('expanded');
            
            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’å†è¨­å®š
            setupFileTreeListeners();
        }
        
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
        previewBtn.addEventListener('click', () => {
            // ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®å†…å®¹ã‚’æ›´æ–°
            saveCurrentFile();
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç”Ÿæˆã—ã¦è¡¨ç¤º
            generatePreview();
            popupOverlay.style.display = 'flex';
            
            // ãƒ‡ãƒã‚¤ã‚¹ã‚µã‚¤ã‚ºã®åˆæœŸè¨­å®šã‚’é©ç”¨
            updatePreviewSize();
        });
        
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚µã‚¤ã‚ºã®æ›´æ–°
        deviceSelector.addEventListener('change', updatePreviewSize);
        
        function updatePreviewSize() {
            const device = deviceSelector.value;
            const iframe = document.getElementById('preview-frame');
            
            switch (device) {
                case 'mobile':
                    iframe.style.width = '375px';
                    iframe.style.height = '667px';
                    break;
                case 'tablet':
                    iframe.style.width = '768px';
                    iframe.style.height = '1024px';
                    break;
                default:
                    iframe.style.width = '100%';
                    iframe.style.height = '100%';
                    break;
            }
        }
        
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
        closePopupBtn.addEventListener('click', () => {
            popupOverlay.style.display = 'none';
        });
        
        // å¤–å´ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‰ã‚Œã‚‹ã‚ˆã†ã«
        popupOverlay.addEventListener('click', (e) => {
            if (e.target === popupOverlay) {
                popupOverlay.style.display = 'none';
            }
        });
        
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ç”Ÿæˆ
        function generatePreview() {
            const iframe = document.getElementById('preview-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            // iframeã®å†…å®¹ã‚’ã‚¯ãƒªã‚¢
            iframeDoc.open();
            
            if (isDirectoryImported) {
                // ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰: èª­ã¿è¾¼ã¾ã‚ŒãŸHTMLãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç”Ÿæˆ
                const mainHtmlFile = currentEditingFile.endsWith('.html') ? 
                    currentEditingFile : 
                    Object.keys(customFiles).find(f => f.endsWith('.html'));
                
                if (mainHtmlFile && customFiles[mainHtmlFile]) {
                    // ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’ä½œæˆ
                    const customFileUrls = {};
                    Object.keys(customFiles).forEach(filePath => {
                        const fileType = filePath.split('.').pop().toLowerCase();
                        let mimeType = 'text/plain';
                        
                        if (fileType === 'css') {
                            mimeType = 'text/css';
                        } else if (fileType === 'js') {
                            mimeType = 'text/javascript';
                        } else if (fileType === 'html') {
                            mimeType = 'text/html';
                        }
                        
                        const blob = new Blob([customFiles[filePath]], { type: mimeType });
                        customFileUrls[filePath] = URL.createObjectURL(blob);
                    });
                    
                    // HTMLã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’ç½®ãæ›ãˆ
                    let htmlContent = customFiles[mainHtmlFile];
                    const basePath = mainHtmlFile.includes('/') ? 
                        mainHtmlFile.substring(0, mainHtmlFile.lastIndexOf('/') + 1) : '';
                    
                    // ç›¸å¯¾ãƒ‘ã‚¹å‚ç…§ã‚’ç½®ãæ›ãˆ
                    Object.keys(customFileUrls).forEach(filePath => {
                        const fileName = filePath.split('/').pop();
                        const relativePath = filePath.replace(basePath, '');
                        
                        const escapedPath = relativePath.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        const regex1 = new RegExp('(href|src)\\s*=\\s*["\']' + escapedPath + '["\']', 'g');
                        const regex2 = new RegExp('(href|src)\\s*=\\s*["\']' + fileName + '["\']', 'g');
                        
                        htmlContent = htmlContent.replace(regex1, `$1="${customFileUrls[filePath]}"`);
                        if (filePath !== mainHtmlFile) {
                            htmlContent = htmlContent.replace(regex2, `$1="${customFileUrls[filePath]}"`);
                        }
                    });
                    
                    // HTMLã‚’iframeã«æ›¸ãè¾¼ã‚€
                    iframeDoc.write(htmlContent);
                } else {
                    iframeDoc.write('<html><body><h1>HTMLãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h1></body></html>');
                }
            } else {
                // ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®3ãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                // Blobã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«URLã‚’ä½œæˆ
                const htmlBlob = new Blob([files['index.html']], { type: 'text/html' });
                const cssBlob = new Blob([files['style.css']], { type: 'text/css' });
                const jsBlob = new Blob([files['script.js']], { type: 'text/javascript' });
                
                // ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’ä½œæˆ
                const htmlUrl = URL.createObjectURL(htmlBlob);
                const cssUrl = URL.createObjectURL(cssBlob);
                const jsUrl = URL.createObjectURL(jsBlob);
                
                // ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å‚ç…§ã‚’ç½®ãæ›ãˆ
                let htmlContent = files['index.html'];
                
                // style.cssã¨script.jsã®å‚ç…§ã‚’ç½®ãæ›ãˆ
                htmlContent = htmlContent.replace(/href\s*=\s*["']style\.css["']/g, `href="${cssUrl}"`);
                htmlContent = htmlContent.replace(/src\s*=\s*["']script\.js["']/g, `src="${jsUrl}"`);
                
                // HTMLã‚’iframeã«æ›¸ãè¾¼ã‚€
                iframeDoc.write(htmlContent);
            }
            
            iframeDoc.close();
        }

        // åˆæœŸåŒ–æ™‚ã«ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
        htmlHighlight.classList.remove('hidden');
    </script>
</body>
</html>
